<ngx-spinner
  bdColor="rgba(0,0,0,0.6)"
  size="medium"
  color="#217fb1"
  type="square-jelly-box"
  [fullScreen]="true"
>
  <p style="color: white">{{ spinnerText }}</p>
</ngx-spinner>
<div class="col-12">
      <button type="button"  *ngIf="showBackButton==true" class="btn btn-sm btn-primary buttonCss" (click)="backToOperationalUI()" translate><i class="fa fa-angle-left"></i> Back To Operational UI</button>
    </div>
<div class="container-fluid px-2">
  <div class="row mx-0 container-row">
    <div class="row mx-0">
      <div class="card col-md-6 plr0" [ngClass]="{smallWidth: showBackButton==false}">
        <div class="card-header">
          <h5 class="mb-0 ml-auto">POI Setpoints</h5>
        </div>
        <div class="card-body">
          <div class="row px-3">
            <div class="col-md-12">
              <form
                [formGroup]="setPointsForm"
                (ngSubmit)="onSubmit()"
                class="form"
              >
                <div class="row">
                  <div class="card col-md-12 plr-half">
                    <div class="row">
                      <div
                        class="col-md-2 text-center plr0 scada-status-section"
                      >
                        <p class="scada-title">Scada Status</p>
                        <p class="dateStamp">
                          {{
                            myDate | date: "dd/MM/yyyy hh:mm:ss a":"UTC +530"
                          }}
                          <!-- {{ myDate | date: "dd-mm-yyyy hh:mm:ss A" }} -->
                        </p>
                        <img
                          *ngIf="isScadaOn"
                          src="./assets/images/on.png"
                          class=""
                          height="60"
                          alt=""
                        />
                        <img
                          *ngIf="!isScadaOn"
                          src="./assets/images/off.png"
                          class=""
                          height="60"
                          alt=""
                        />
                      </div>
                      <div class="col-md-10 bleft mb-2">
                        <div class="row mx-0 mt-4">
                          <div class="col-md-4 plr0 mb-1">
                            <label for="exampleRadios3" class="">
                              Mode of Operation
                              <span class="text-danger">*</span>
                            </label>
                          </div>
                          <div class="col-md-8 pl0 mb-1">
                            <select
                              class="form-control plr0"
                              id="exampleFormControlSelect1"
                              formControlName="qref"
                              [(ngModel)]="qrefm"
                              (change)="checkMode($event)"
                            >
                              <option selected disabled value="">
                                Choose..
                              </option>
                              <option
                                *ngFor="let ddcode of reactiveCodes"
                                value="{{ ddcode.codeValue }}"
                              >
                                {{ ddcode.codeDisplayTxt }}
                              </option>
                            </select>
                          </div>
                          <!-- <div class="col-md-12 pl0"> -->
                          <!-- <div class="row mt-4"> -->
                          <div class="form-group col-md-4 plr0 mt-3">
                            <label
                              for="exampleInputEmail1"
                              class="form-group-labels"
                              >Active Power Setpoint (MW)<span
                                class="text-danger"
                                >*</span
                              ></label
                            >
                          </div>
                          <div class="col-md-2 pl0 mt-3">
                            <input
                              type="text"
                              class="form-control"
                              id="exampleInputEmail1"
                              aria-describedby="emailHelp"
                              placeholder="PSet"
                              formControlName="p"
                              [(ngModel)]="pPt"
                              [disabled]="nightMode"
                              oninput="this.value = this.value.replace(/[^0-9.]/g, '')"
                            />
                          </div>
                          <div class="form-group col-md-4 pr0 mt-3">
                            <label
                              for="exampleInputEmail2"
                              class="form-group-labels"
                              >Reactive Power Setpoint (MVAr)<span
                                class="text-danger"
                                >*</span
                              ></label
                            >
                          </div>
                          <div class="col-md-2 pl0 mt-3">
                            <input
                              type="number"
                              class="form-control"
                              id="exampleInputEmail2"
                              aria-describedby="emailHelp"
                              placeholder="QSet"
                              formControlName="q"
                              [(ngModel)]="qPoint"
                            />
                          </div>
                          <div class="form-group col-md-4 mt-3 pl0">
                            <label
                              for="exampleInputEmail3"
                              class="form-group-labels"
                              >PFSign</label
                            ><span *ngIf="isCheckedFactor" class="text-danger"
                              >*</span
                            >
                          </div>
                          <div class="col-md-2 pl0 mt-3">
                            <select
                              class="form-control pfsign"
                              formControlName="pfsign"
                              [disabled]="disableReactive"
                              [(ngModel)]="selectedValue"
                            >
                              <option selected disabled value="">
                                Choose..
                              </option>
                              <option
                                *ngFor="let pfsign of pfsignCodes"
                                value="{{ pfsign.codeValue }}"
                              >
                                {{ pfsign.codeDisplayTxt }}
                              </option>
                            </select>
                          </div>
                          <div class="form-group col-md-4 mt-3">
                            <label
                              for="exampleInputEmail4"
                              class="form-group-labels"
                              >Power Factor Setpoint</label
                            ><span *ngIf="isCheckedFactor" class="text-danger"
                              >*</span
                            >
                          </div>
                          <div class="col-md-2 pl0 mt-3">
                            <input
                              type="text"
                              class="form-control"
                              id="exampleInputEmail4"
                              aria-describedby="emailHelp"
                              placeholder="PFSet"
                              formControlName="pf"
                              [disabled]="disableReactive"
                              [(ngModel)]="pfs"
                              oninput="this.value = this.value.replace(/[^0-9.]/g, '')"
                            />
                          </div>
                          <!-- </div> -->
                          <!-- </div> -->
                        </div>
                        <div class="col-md-12 text-center mt-5">
                          <button
                            type="button"
                            class="btn btn-sm btn-primary mr-2"
                            (click)="resetForm()"
                          >
                            <i class="fa fa-refresh mr-1"></i>
                            Reset
                          </button>
                          <button
                            type="submit"
                            [disabled]="setPointsForm.invalid || isScadaOn"
                            class="btn btn-sm btn-success"
                          >
                            <i class="fa fa-save mr-1"></i>
                            Set
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 pr0 pl3 " [ngClass]="{smallWidth:showBackButton==false}">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0 ml-auto">PPC Logs</h5>
          </div>
          <div class="card-body">
            <div class="row justify-content-between mx-0">
              <div class="col-md-12 plr0">
                <strong class="filters" translate>Filters: </strong>
                <strong
                  class="filters-list"
                  *ngIf="ppcTableFilter1 == null || ppcTableFilter1.length == 0"
                  translate
                >
                  No Filter Selected
                </strong>
                <span
                  class="filter-tabs"
                  *ngFor="let filter of ppcTableFilter1"
                >
                  {{ filter }}
                  <a
                    (click)="clearFilterErrorTable(filter)"
                    class="cursor-pointer"
                    >&times;</a
                  >
                </span>
                <span class="float-right">
                  <i
                    class="fa fa-download fa-lg mt-2 cursor-pointer"
                    title="Download CSV"
                    style="color: black !important"
                    (click)="exportTOExcel()"
                    aria-hidden="true"
                  ></i>
                </span>
                <!-- <div class="col-sm-12 plr0">
                  <div class="row">
                    <div class="col-sm-4 plr0">
                      <div class="form-inline mb-2">
                        <label for="Form" class="enddt text-dark small-text" translate
                          >Show from<span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          name="startdate"
                          placeholder="MM/DD/YYYY"
                          class="form-control form-control-sm caldate mr-2 inputWidth"
                          id="startdate"
                          [bsConfig]="bsConfig"
                          [(ngModel)]="setStartDate"
                          [maxDate]="maxDate"
                          bsDatepicker
                          #dp1="bsDatepicker"
                          required
                        /> -->
                <!-- <i
                          class="fa fa-calendar"
                          style="color: black"
                          aria-hidden="true"
                        ></i> -->
                <!-- </div>
                    </div>
                    <div class="col-sm-4 plr0">
                      <div class="form-inline mb-2">
                        <label for="Form" class="enddt text-dark small-text" translate
                          >Show to<span class="text-danger">*</span></label
                        >
                        <input
                          type="text"
                          name="startdate"
                          placeholder="MM/DD/YYYY"
                          class="form-control form-control-sm caldate mr-2 inputWidth"
                          id="startdate"
                          [bsConfig]="bsConfig"
                          [(ngModel)]="setStartDate"
                          [maxDate]="maxDate"
                          bsDatepicker
                          #dp1="bsDatepicker"
                          required
                        /> -->
                <!-- <i
                          class="fa fa-calendar"
                          style="color: black"
                          aria-hidden="true"
                        ></i> -->
                <!-- </div>
                    </div>
                    <div class="col-md-4 plr0">
                      <button type="submit" class="btn btn-sm btn-primary mr-2 small-text custom-btn">View</button>
                    </div>
                  </div>
                  
                </div> -->
              </div>
              <div class="col-md-12 plr0">
                <ag-grid-angular
                  #errorQualityTable
                  id="errorQualityTable"
                  style="width: 100%; height: 250px"
                  class="ag-theme-balham"
                  [rowData]="errorPointsData"
                  [columnDefs]="columnDefs1"
                  (filterChanged)="filterModifiedErrorTable()"
                  [gridOptions]="gridOptions1"
                  (gridReady)="onGridReady1($event)"
                >
                </ag-grid-angular>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-2 col-md-12 plr0">
      <div class="card-header">
        <h5 class="mb-0 ml-auto">Setpoints History</h5>
      </div>
      <div class="card-body">
        <div class="row justify-content-between mx-0">
          <div class="col-sm-12 plr0">
            <strong class="filters" translate>Filters: </strong>
            <strong
              class="filters-list"
              *ngIf="ppcTableFilter == null || ppcTableFilter.length == 0"
              translate
            >
              No Filter Selected
            </strong>
            <span class="filter-tabs" *ngFor="let filter of ppcTableFilter">
              {{ filter }}
              <a (click)="clearFilterLogTable(filter)" class="cursor-pointer"
                >&times;</a
              >
            </span>
            <span class="float-right">
              <i
                class="fa fa-download fa-lg mt-2 cursor-pointer"
                title="Download CSV"
                style="color: black !important"
                (click)="exportTOExcel1()"
                aria-hidden="true"
              ></i>
            </span>
          </div>
          <div class="col-md-12 plr0">
            <ag-grid-angular
              #setPointTable
              style="
                width: 100%;
                min-height: 250px;
                height: calc(100vh - 504px);
              "
              class="ag-theme-balham"
              [rowData]="rowData"
              [columnDefs]="columnDefs"
              (filterChanged)="filterModifiedLogTable()"
              [gridOptions]="gridOptions"
              (gridReady)="onGridReady($event)"
            >
            </ag-grid-angular>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
